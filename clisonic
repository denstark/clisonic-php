#!/usr/bin/php
<?php

$script = 'controller';
require_once('initialize.php');

$action = isset($argv[1]) ? $argv[1] : 'browse';

array_shift($argv); // pull off the script name
array_shift($argv); // pull off the action

// Launch daemon if it isn't already running
exec('ps -C clisonicd', $output, $notRunning);

if ($notRunning)
  exec('./clisonicd > /tmp/clisonic.out 2>&1 &');

try
{
  csController::go($action, $argv);
}
catch (Exception $ex)
{
  echo "Error: {$ex->getMessage()}\n";
}